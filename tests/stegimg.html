<!DOCTYPE html>
<html>
    <head>
        <title>StegPng</title>
    </head>
    <body>
        <div id="in" style="display: inline"></div>
        <div id="out" style="display: inline"></div>
        <script type="module">
            import * as util from '../src/utils.js'
            import dat from 'https://cdn.skypack.dev/dat.gui'

            const inDiv = document.getElementById('in')
            const outDiv = document.getElementById('out')
            const imgName = 'flock.png'

            const imgIn = await util.imagePromise(imgName)
            inDiv.append(imgIn)

            function stegify(img, bits) {
                const ctx = util.createCtxFromImage(img)
                const imgData = util.ctxImageData(ctx)
                imgData.data.forEach((val, i) => {
                    // Don't change alpha, just RGB
                    if (i % 4 !== 3) {
                        imgData.data[i] = (val >> bits) << bits
                    }
                })
                ctx.putImageData(imgData, 0, 0)
                return ctx.canvas
            }

            const gui = new dat.GUI()
            gui.add({ bits: 2 }, 'bits', 0, 8, 1).onFinishChange(bits => {
                const can = stegify(imgIn, bits)
                outDiv.replaceChildren(can)
            })
        </script>
    </body>
</html>
